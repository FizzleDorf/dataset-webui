# LoRA Dataset Webui
[Webui Screenshot](https://github.com/city96/dataset-scripts/blob/main/other/ui_screenshot.png)

This project aims to help with the creation and management of LoRa training datasets.

*Pull requests are welcome. Currently everything is just cobbled together*

Roadmap:
- Fix orphaned images
- Refractor tag management
- Add single-image tag overrides
- Add autotagging/autosorting support

Known issues:
- No files/folders are ever deleted, leading to clutter/orphaned images
- Webui scrolls by random amount on first button click

## Getting started
(optional) create a venv first:
```
python -m venv venv
venv\Scripts\activate
```

install the requirements:
```
pip install -r requirements.txt
```

start either by running `start.bat` or manually using:
```
python webserver.py
```

Access the webui on the following URL: http://127.0.0.1:8080/

### Launch arguments
Add these to `start.bat` or use them when calling `webserver.py` directly.
- `-p PORT`, `--port PORT` - Port to host webui on
- `--autolaunch` - Open webui in default browser
- `--listen` - Allow access from LAN (NOT RECOMMENDED)

### download-dependencies.py
Running this script is recommended to get all features of the webui.

**using start.bat already downloads all dependencies by default**

It will gives you the option to download the following files:
- `danbooru-tags.json` and `gelbooru-tags.json` from github gist or catbox.moe.
	- You also have the option to scrape the tags from the site directly.
- `cropper.js` and `cropper.css` from Cloudflare/cdnjs.

## Folder structure

The folders created are meant to be used as follows:
- `0 - raw` - raw images from the internet / screenshots
- `1 - cropped` - cropped images (1:1 aspect ratio)
- `2 - sorted` - images grouped by quality / topic / etc
- `3 - tagged` - generated or scraped tags + downscaling of images to uniform resolution
- `4 - fixed` - automatically fixed tags based on ruleset (`fix-tags.py`)
- `5 - out` - (optional) final manual review / tag edits using external software.
- `datasets` - all your datasets are saved here

## FAQ
### Where do I get autogenerated tags from\?
If you're using the stable-diffusion-webui, you should have the option to do the tagging and scaling of images (`2 - sorted` -> `3 - tagged`) with the webui.
- change the `Interrogate: deepbooru score threshold` option in the main settings tab to around 0.7 or 0.8 to get less random tags.
- Under the `Train` tab, select `Preprocess images`.
	- Set your resolution to the required size
	- Make sure "Use deepbooru for caption" is checked.

### How do I remove character attributes?
The blacklist is applied last, so use all built-in functions as usual (eg. normalize hair color, replace redundant tags) then put these tags in the blacklist. This is simpler than trying to have every tag variation in your blacklist.
